<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>e:\githubproject\coffeenewspaper\coffeenewspaper\cn_service\serviceimplement\memoservice.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using CN_Core;
using CN_Core.Interfaces.Repository;
using CN_Core.Interfaces.Service;

namespace CN_Service
{
    public class MemoService : IMemoService
    {
        private readonly IMemoDataStore memoDataStore;
        private readonly ITaskDataStore taskDataStore;

        public MemoService(IMemoDataStore MemoDataStore, ITaskDataStore TaskDataStore)
        {
            memoDataStore = MemoDataStore;
            taskDataStore = TaskDataStore;
        }

        public async Task&lt;string&gt; AddAMemoToTask(CNMemo memo, int taskid)
        {
            if (memo == null) return string.Empty;
            var task = await taskDataStore.GetTask(taskid);
            if (task == null) return string.Empty;
            //Add memo To Task
            memo.TaskMemos.Add(new CNTaskMemo
            {
                Task = task,
                Memo = memo
            });
            //if MemoId is Null add the Memo
            if (string.IsNullOrEmpty(memo.MemoId))
            {
                var memo1 = memo;
                task.TaskTaggers.Select(x =&gt; x.Tag)
                    .ToList()
                    .ForEach(y =&gt; memo1.MemoTaggers.Add(new CNMemoTagger {Memo = memo1, Tag = y}));
                memo = await memoDataStore.AddMemo(memo);
            }
            //else Update it
            else
            {
                if (!await memoDataStore.UpdateMemo(memo)) return string.Empty;
            }
            
            return memo?.MemoId;
        }

        public async Task&lt;string&gt; AddAMemoToGlobal(CNMemo memo)
        {
            if (memo == null) return string.Empty;
            memo = await memoDataStore.AddMemo(memo);
            return memo?.MemoId;
        }

        public async Task&lt;bool&gt; UpdateAMemo(CNMemo memo)
        {
            if (memo == null) return false;
            return await memoDataStore.UpdateMemo(memo);
        }

        public async Task&lt;bool&gt; DeleteAMemo(string memoId)
        {
            var memo = await memoDataStore.GetMemoById(memoId);
            if (memo == null) return false;
            return await memoDataStore.DeleteMemo(memo);
        }

        public async Task&lt;bool&gt; RemoveAMemoFromTask(string memoId, int taskId)
        {
            //Assert memo exist
            var memo = await memoDataStore.GetMemoById(memoId);
            if (memo == null) return false;
            //Assert memo-task relation exist
            var tobeRemovedRelations = memo.TaskMemos.Where(x =&gt; x.TaskId == taskId).ToList();
            if(!tobeRemovedRelations.Any())return false;
            //remove and update
            tobeRemovedRelations.ToList().ForEach(x =&gt; memo.TaskMemos.Remove(x));
            return await memoDataStore.UpdateMemo(memo);
        }

        public async Task&lt;ICollection&lt;CNMemo&gt;&gt; GetAllGlobalMemos()
        {
            return await memoDataStore.GetAllGlobalMemos();
        }

        public async Task&lt;ICollection&lt;CNMemo&gt;&gt; GetAllTaskMemos(int taskid)
        {
            return await memoDataStore.GetAllTaskMemos(taskid);
        }

        public async Task&lt;CNMemo&gt; GetMemoById(string memoId)
        {
            return await memoDataStore.GetMemoById(memoId);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[15,9,15,87,1],[16,9,16,10,1],[17,13,17,43,1],[18,13,18,43,1],[19,9,19,10,1],[22,9,22,10,1],[23,13,23,30,1],[23,31,23,51,1],[24,13,24,60,1],[25,13,25,30,1],[25,31,25,51,1],[27,13,31,16,1],[33,13,33,51,1],[34,13,34,14,1],[35,17,35,34,1],[36,17,36,46,1],[36,46,36,51,1],[36,51,38,35,1],[38,35,38,98,1],[38,98,38,100,1],[36,17,38,100,1],[39,17,39,58,1],[40,13,40,14,1],[43,13,43,14,1],[44,17,44,59,1],[44,60,44,80,1],[45,13,45,14,1],[47,13,47,33,1],[48,9,48,10,1],[51,9,51,10,1],[52,13,52,30,1],[52,31,52,51,1],[53,13,53,54,1],[54,13,54,33,1],[55,9,55,10,1],[58,9,58,10,1],[59,13,59,30,1],[59,31,59,44,1],[60,13,60,57,1],[61,9,61,10,1],[64,9,64,10,1],[65,13,65,64,1],[66,13,66,30,1],[66,31,66,44,1],[67,13,67,57,1],[68,9,68,10,1],[71,9,71,10,1],[73,13,73,64,1],[74,13,74,30,1],[74,31,74,44,1],[76,13,76,66,1],[76,66,76,84,1],[76,84,76,95,1],[76,13,76,95,1],[77,13,77,44,1],[77,44,77,57,1],[79,13,79,56,1],[79,56,79,80,1],[79,80,79,82,1],[79,13,79,82,1],[80,13,80,57,1],[81,9,81,10,1],[84,9,84,10,1],[85,13,85,60,1],[86,9,86,10,1],[89,9,89,10,1],[90,13,90,64,1],[91,9,91,10,1],[94,9,94,10,1],[95,13,95,60,1],[96,9,96,10,1]]);
    </script>
  </body>
</html>