<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>e:\githubproject\coffeenewspaper\coffeenewspaper\cn_cli\command\taskeditcommand.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Drawing;
using System.Threading.Tasks;
using CN_Core;
using CN_Core.Interfaces.Service;
using Console = Colorful.Console;

namespace CoffeeNewspaper_CLI
{
    public class TaskEditCommand : BaseCommand
    {
        public TaskEditCommand(BaseState state) : base(state)
        {
            Name = &quot;edit&quot;;
        }

        public override async Task&lt;BaseState&gt; Excute(ArgumentParser input)
        {
            if (State != null &amp;&amp; State.StateObj is CNTask task)
            {
                var content = input.GetSingle&lt;string&gt;(&quot;c&quot;);
                if (!string.IsNullOrEmpty(content)) task.Content = content;
                var deadline = input.GetSingle&lt;DateTime&gt;(&quot;d&quot;);
                if (deadline &gt; DateTime.MinValue) task.DeadLine = deadline;
                var estimatedDuration = input.GetSingle&lt;string&gt;(&quot;e&quot;);
                if (!string.IsNullOrEmpty(estimatedDuration))
                    task.EstimatedDuration = GetDurationMinutes(estimatedDuration);
                var priority = input.GetSingle&lt;int&gt;(&quot;p&quot;);
                switch (priority)
                {
                    case 1:
                    {
                        task.Priority = CNPriority.VeryLow;
                        break;
                    }
                    case 2:
                    {
                        task.Priority = CNPriority.Low;
                        break;
                    }
                    case 3:
                    {
                        task.Priority = CNPriority.Normal;
                        break;
                    }
                    case 4:
                    {
                        task.Priority = CNPriority.High;
                        break;
                    }
                    case 5:
                    {
                        task.Priority = CNPriority.VeryHigh;
                        break;
                    }
                }

                var urgency = input.GetSingle&lt;int&gt;(&quot;u&quot;);
                switch (urgency)
                {
                    case 1:
                    {
                        task.Urgency = CNUrgency.VeryLow;
                        break;
                    }
                    case 2:
                    {
                        task.Urgency = CNUrgency.Low;
                        break;
                    }
                    case 3:
                    {
                        task.Urgency = CNUrgency.Normal;
                        break;
                    }
                    case 4:
                    {
                        task.Urgency = CNUrgency.High;
                        break;
                    }
                    case 5:
                    {
                        task.Urgency = CNUrgency.VeryHigh;
                        break;
                    }
                }

                int parentTaskId = input.GetSingle&lt;int&gt;(&quot;parent&quot;);
                if (parentTaskId &gt; 0)
                {
                    var parentTask = await IoC.Get&lt;ITaskService&gt;().GetTaskById(parentTaskId);
                    await IoC.Get&lt;ITaskService&gt;().SetParentTask(task.TaskId, parentTask.TaskId,-1);
                }
                State.Refresh();
            }
            else
            {
                Console.WriteLine(&quot;wrong parameter&quot;, Color.Red);
            }

            Console.WriteLine();
            return State;
        }

        private int GetDurationMinutes(string estimatedDuration)
        {
            if (string.IsNullOrEmpty(estimatedDuration)) return CNConstants.ESTIMATED_DURATION_NOTWRITE;
            if (estimatedDuration.Trim().EndsWith(&quot;m&quot;, StringComparison.CurrentCultureIgnoreCase))
            {
                var minutes = estimatedDuration.Trim().Replace(&quot;m&quot;, &quot;&quot;);
                return Convert.ToInt32(minutes);
            }

            if (estimatedDuration.Trim().EndsWith(&quot;h&quot;, StringComparison.CurrentCultureIgnoreCase))
            {
                var hours = estimatedDuration.Trim().Replace(&quot;h&quot;, &quot;&quot;);
                return Convert.ToInt32(Convert.ToDouble(hours) * 60);
            }

            if (estimatedDuration.Trim().EndsWith(&quot;d&quot;, StringComparison.CurrentCultureIgnoreCase))
            {
                var days = estimatedDuration.Trim().Replace(&quot;d&quot;, &quot;&quot;);
                return Convert.ToInt32(Convert.ToDouble(days) * 24 * 60);
            }

            if (estimatedDuration.Trim().EndsWith(&quot;w&quot;, StringComparison.CurrentCultureIgnoreCase))
            {
                var weeks = estimatedDuration.Trim().Replace(&quot;w&quot;, &quot;&quot;);
                return Convert.ToInt32(Convert.ToDouble(weeks) * 7 * 24 * 60);
            }

            return Convert.ToInt32(estimatedDuration.Trim());
        }

    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[12,51,12,62,0],[13,9,13,10,0],[14,13,14,27,0],[15,9,15,10,0],[18,9,18,10,0],[19,13,19,64,0],[20,13,20,14,0],[21,17,21,60,0],[22,17,22,52,0],[22,53,22,76,0],[23,17,23,63,0],[24,17,24,50,0],[24,51,24,76,0],[25,17,25,70,0],[26,17,26,62,0],[27,21,27,84,0],[28,17,28,58,0],[29,17,29,34,0],[32,21,32,22,0],[33,25,33,60,0],[34,25,34,31,0],[37,21,37,22,0],[38,25,38,56,0],[39,25,39,31,0],[42,21,42,22,0],[43,25,43,59,0],[44,25,44,31,0],[47,21,47,22,0],[48,25,48,57,0],[49,25,49,31,0],[52,21,52,22,0],[53,25,53,61,0],[54,25,54,31,0],[58,17,58,57,0],[59,17,59,33,0],[62,21,62,22,0],[63,25,63,58,0],[64,25,64,31,0],[67,21,67,22,0],[68,25,68,54,0],[69,25,69,31,0],[72,21,72,22,0],[73,25,73,57,0],[74,25,74,31,0],[77,21,77,22,0],[78,25,78,55,0],[79,25,79,31,0],[82,21,82,22,0],[83,25,83,59,0],[84,25,84,31,0],[88,17,88,67,0],[89,17,89,38,0],[90,17,90,18,0],[91,21,91,94,0],[92,21,92,100,0],[93,17,93,18,0],[94,17,94,33,0],[95,13,95,14,0],[97,13,97,14,0],[98,17,98,65,0],[99,13,99,14,0],[101,13,101,33,0],[102,13,102,26,0],[103,9,103,10,0],[106,9,106,10,0],[107,13,107,57,0],[107,58,107,105,0],[108,13,108,99,0],[109,13,109,14,0],[110,17,110,73,0],[111,17,111,49,0],[114,13,114,99,0],[115,13,115,14,0],[116,17,116,71,0],[117,17,117,70,0],[120,13,120,99,0],[121,13,121,14,0],[122,17,122,70,0],[123,17,123,74,0],[126,13,126,99,0],[127,13,127,14,0],[128,17,128,71,0],[129,17,129,79,0],[132,13,132,62,0],[133,9,133,10,0]]);
    </script>
  </body>
</html>