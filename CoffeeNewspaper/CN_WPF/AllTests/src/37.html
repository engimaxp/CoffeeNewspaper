<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>e:\githubproject\coffeenewspaper\coffeenewspaper\cn_core\utilities\datetimehelper.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;

namespace CN_Core.Utilities
{
    public static class DateTimeHelper
    {
        public static string EarlyTimeFormat(this DateTime time,DateTime? refrenceTime = null)
        {
            var now = refrenceTime??DateTime.Now;
            var diff = now - time;
            var diffDate = now.Date - time.Date;
            if (diff.TotalHours &lt; 7)
            {
                return MinuteAgo(diff);
            }
            else if (now.AddMonths(-1) &lt;= time)
            {
                return EarlyToday(time, now, diffDate);
            }
            else if (now.AddMonths(-1) &gt; time &amp;&amp; now.AddMonths(-2) &lt;= time) return &quot;1 Month Ago&quot;;
            else if (now.AddMonths(-2) &gt; time &amp;&amp; now.AddYears(-1) &lt;= time)
            {
                return MonthsAgo(time, diff, now);
            }
            else if (now.AddYears(-1) &gt;= time &amp;&amp; now.AddYears(-2) &lt;= time) return &quot;1 Year Ago&quot;;
            else if (now.AddYears(-2) &gt; time)
            {
                return YearsAgo(time, diff, now);
            }

            return &quot;Error&quot;;
        }

        private static string YearsAgo(DateTime time, TimeSpan diff, DateTime now)
        {
            var n = diff.Days / 365;
            if (now.AddYears(-n) &lt;= time &amp;&amp; now.AddYears(-n + 1) &gt; time)
                return $&quot;{n} Years Ago&quot;;
            else if (now.AddYears(-n - 1) &lt;= time &amp;&amp; now.AddYears(-n) &gt; time)
                return $&quot;{n + 1} Years Ago&quot;;
            else if (now.AddYears(-n + 1) &lt;= time &amp;&amp; now.AddYears(-n + 2) &gt; time)
                return $&quot;{n - 1} Years Ago&quot;;
            else return &quot;Error Years&quot;;
        }

        private static string MonthsAgo(DateTime time, TimeSpan diff, DateTime now)
        {
            var n = diff.Days / 30;
            if (now.AddMonths(-n) &lt;= time &amp;&amp; now.AddMonths(-n + 1) &gt; time)
                return $&quot;{n} Months Ago&quot;;
            else if (now.AddMonths(-n - 1) &lt;= time &amp;&amp; now.AddMonths(-n) &gt; time)
                return $&quot;{n + 1} Months Ago&quot;;
            else if (now.AddMonths(-n + 1) &lt;= time &amp;&amp; now.AddMonths(-n + 2) &gt; time)
                return $&quot;{n - 1} Months Ago&quot;;
            else return &quot;Error Months&quot;;
        }

        private static string MinuteAgo(TimeSpan diff)
        {
            if (diff.TotalSeconds &lt; 60) return &quot;Just Now&quot;;
            else if (diff.TotalSeconds &gt;= 60 &amp;&amp; diff.TotalSeconds &lt; 120) return &quot;1 Minute Ago&quot;;
            else if (diff.TotalSeconds &gt;= 120 &amp;&amp; diff.TotalMinutes &lt; 60) return $&quot;{diff.Minutes} Minutes Ago&quot;;
            else if (diff.TotalSeconds &gt;= 3600 &amp;&amp; diff.TotalSeconds &lt; 3600 * 2) return &quot;1 Hour Ago&quot;;
            else return $&quot;{diff.Hours} Hours Ago&quot;;
        }

        private static string EarlyToday(DateTime time, DateTime now, TimeSpan diffDate)
        {
            if (now.Date == time.Date) return &quot;Early Today&quot;;
            else if (now.Date == time.Date.AddDays(1)) return &quot;Yesterday&quot;;
            else if (diffDate.TotalDays &gt;= 2 &amp;&amp; diffDate.TotalDays &lt; 7) return $&quot;{diffDate.Days} Days Ago&quot;;
            else if (diffDate.TotalDays &gt;= 7 &amp;&amp; diffDate.TotalDays &lt; 7 * 2) return &quot;1 Week Ago&quot;;
            else return $&quot;{(int) diffDate.TotalDays / 7} Weeks Ago&quot;;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[8,9,8,10,1],[9,13,9,50,1],[10,13,10,35,1],[11,13,11,49,1],[12,13,12,37,1],[13,13,13,14,1],[14,17,14,40,1],[16,18,16,48,1],[17,13,17,14,1],[18,17,18,56,1],[20,18,20,76,1],[20,77,20,98,1],[21,18,21,75,1],[22,13,22,14,1],[23,17,23,51,1],[25,18,25,75,1],[25,76,25,96,1],[26,18,26,46,1],[27,13,27,14,1],[28,17,28,50,1],[31,13,31,28,0],[32,9,32,10,1],[35,9,35,10,1],[36,13,36,37,1],[37,13,37,73,1],[38,17,38,41,1],[39,18,39,78,0],[40,17,40,45,0],[41,18,41,82,0],[42,17,42,45,0],[43,18,43,39,0],[44,9,44,10,1],[47,9,47,10,1],[48,13,48,36,1],[49,13,49,75,1],[50,17,50,42,1],[51,18,51,80,0],[52,17,52,46,0],[53,18,53,84,0],[54,17,54,46,0],[55,18,55,40,0],[56,9,56,10,1],[59,9,59,10,1],[60,13,60,40,1],[60,41,60,59,1],[61,18,61,73,1],[61,74,61,96,1],[62,18,62,73,1],[62,74,62,111,1],[63,18,63,80,1],[63,81,63,101,1],[64,18,64,51,1],[65,9,65,10,1],[68,9,68,10,1],[69,13,69,39,1],[69,40,69,61,1],[70,18,70,55,1],[70,56,70,75,1],[71,18,71,72,1],[71,73,71,108,1],[72,18,72,76,1],[72,77,72,97,1],[73,18,73,69,1],[74,9,74,10,1]]);
    </script>
  </body>
</html>