<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>e:\githubproject\coffeenewspaper\coffeenewspaper\coffeenewspaper_unittest\servicetest\memoservicetest.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Collections.Generic;
using System.Threading.Tasks;
using CN_Core;
using CN_Core.Interfaces.Repository;
using CN_Core.Interfaces.Service;
using CoffeeNewspaper_UnitTest.DomainTest;
using Ninject;
using NSubstitute;
using NUnit.Framework;

namespace CoffeeNewspaper_UnitTest.ServiceTest
{
    [TestFixture]
    public class MemoServiceTest : ServiceSetupTearDown
    {
        [Test]
        public async Task AddAMemoToTask_MemoNull_Fail()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var mockTaskDataStore = _kernel.Get&lt;ITaskDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Assess
            mockTaskDataStore.GetTask(1).Returns(Task.FromResult(DomainTestHelper.GetARandomTask()));
            mockMemoDataStore.AddMemo(Arg.Any&lt;CNMemo&gt;())
                .Returns(DomainTestHelper.GetARandomMemo(true));

            //Act
            var result = await targetService.AddAMemoToTask(null, 1);

            //Assert
            Assert.True(string.IsNullOrEmpty(result));
            mockMemoDataStore.DidNotReceiveWithAnyArgs().AddMemo(Arg.Any&lt;CNMemo&gt;());
        }
        [Test]
        public async Task AddAMemoToTask_TaskExist_Success()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var mockTaskDataStore = _kernel.Get&lt;ITaskDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();
            var mockTask = DomainTestHelper.GetARandomTask();
            var mockTag = DomainTestHelper.GetARandomTag();
            mockTask.TaskTaggers = new List&lt;CNTaskTagger&gt;(){new CNTaskTagger(){Tag = mockTag,Task = mockTask}};
            //Assess
            mockTaskDataStore.GetTask(1).Returns(Task.FromResult(mockTask));
            mockMemoDataStore.AddMemo(Arg.Any&lt;CNMemo&gt;())
                .Returns(DomainTestHelper.GetARandomMemo(true));

            //Act
            var result = await targetService.AddAMemoToTask(DomainTestHelper.GetARandomMemo(), 1);

            //Assert
            Assert.IsFalse(string.IsNullOrEmpty(result));
            mockMemoDataStore.Received().AddMemo(Arg.Is&lt;CNMemo&gt;(x =&gt; x.TaskMemos.Count &gt; 0 &amp;&amp; x.MemoTaggers.Count&gt;0));
        }

        [Test]
        public async Task AddAMemoToTask_TaskExistMemoExist_Success()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var mockTaskDataStore = _kernel.Get&lt;ITaskDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Assess
            mockTaskDataStore.GetTask(1).Returns(Task.FromResult(DomainTestHelper.GetARandomTask()));
            mockMemoDataStore.UpdateMemo(Arg.Any&lt;CNMemo&gt;());

            //Act
            var result = await targetService.AddAMemoToTask(DomainTestHelper.GetARandomMemo(true), 1);

            //Assert
            Assert.IsFalse(string.IsNullOrEmpty(result));
            mockMemoDataStore.Received().UpdateMemo(Arg.Is&lt;CNMemo&gt;(x =&gt; x.TaskMemos.Count &gt; 0));
        }

        [Test]
        public async Task AddAMemoToTask_DBFail_False()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var mockTaskDataStore = _kernel.Get&lt;ITaskDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Assess
            mockTaskDataStore.GetTask(1).Returns(Task.FromResult(DomainTestHelper.GetARandomTask()));
            mockMemoDataStore.UpdateMemo(Arg.Any&lt;CNMemo&gt;());

            //Act
            await targetService.AddAMemoToTask(DomainTestHelper.GetARandomMemo(true), 1);

            //Assert
            mockMemoDataStore.Received().UpdateMemo(Arg.Is&lt;CNMemo&gt;(x =&gt; x.TaskMemos.Count &gt; 0));
        }
        [Test]
        public async Task AddAMemoToTask_TaskNotExist_Fail()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var mockTaskDataStore = _kernel.Get&lt;ITaskDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Assess
            mockTaskDataStore.GetTask(1).Returns(Task.FromResult((CNTask) null));

            //Act
            var result = await targetService.AddAMemoToTask(DomainTestHelper.GetARandomMemo(), 1);

            //Assert
            Assert.IsTrue(string.IsNullOrEmpty(result));
            mockMemoDataStore.DidNotReceiveWithAnyArgs().AddMemo(Arg.Any&lt;CNMemo&gt;());
        }

        [Test]
        public async Task DeleteAMemo_MemoExist_Success()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Assess
            var testMemo = DomainTestHelper.GetARandomMemo(true);
            mockMemoDataStore.GetMemoById(testMemo.MemoId).Returns(Task.FromResult(testMemo));

            //Act
            var result = await targetService.DeleteAMemo(testMemo.MemoId);

            //Assert
            Assert.IsFalse(result);
            mockMemoDataStore.Received().DeleteMemo(Arg.Is&lt;CNMemo&gt;(x =&gt; x.MemoId == testMemo.MemoId));
        }

        [Test]
        public async Task DeleteAMemo_MemoNotExist_Fail()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Assess
            var testMemo = DomainTestHelper.GetARandomMemo(true);
            mockMemoDataStore.GetMemoById(testMemo.MemoId).Returns(Task.FromResult((CNMemo) null));

            //Act
            var result = await targetService.DeleteAMemo(testMemo.MemoId);

            //Assert
            Assert.IsFalse(result);
            mockMemoDataStore.DidNotReceiveWithAnyArgs().DeleteMemo(Arg.Any&lt;CNMemo&gt;());
        }


        [Test]
        public async Task RemoveAMemoFromTask_MemoNotExist_Fail()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Assess
            var assesMemo = DomainTestHelper.GetARandomMemo(true);
            mockMemoDataStore.GetMemoById(assesMemo.MemoId).Returns(Task.FromResult((CNMemo) null));

            //Act
            var result = await targetService.RemoveAMemoFromTask(assesMemo.MemoId, 1);

            //Assert
            Assert.False(result);
            mockMemoDataStore.DidNotReceiveWithAnyArgs().UpdateMemo(Arg.Any&lt;CNMemo&gt;());
        }

        [Test]
        public async Task RemoveAMemoFromTask_Success()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Assess
            var assesMemo = DomainTestHelper.GetARandomMemo(true);
            var assesTask = DomainTestHelper.GetARandomTask();
            assesMemo.TaskMemos.Add(new CNTaskMemo
            {
                Memo = assesMemo,
                MemoId = assesMemo.MemoId,
                Task = assesTask,
                TaskId = assesTask.TaskId
            });
            mockMemoDataStore.GetMemoById(assesMemo.MemoId).Returns(Task.FromResult(assesMemo));
            mockMemoDataStore.UpdateMemo(Arg.Any&lt;CNMemo&gt;());
            //Act
            await targetService.RemoveAMemoFromTask(assesMemo.MemoId, assesTask.TaskId);

            //Assert
            mockMemoDataStore.Received().UpdateMemo(Arg.Is&lt;CNMemo&gt;(x =&gt; x.TaskMemos.Count == 0));
        }

        [Test]
        public async Task RemoveAMemoFromTask_TaskMemoRelationNotExist_Fail()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Assess
            var assesMemo = DomainTestHelper.GetARandomMemo(true);
            mockMemoDataStore.GetMemoById(assesMemo.MemoId).Returns(Task.FromResult(assesMemo));

            //Act
            var result = await targetService.RemoveAMemoFromTask(assesMemo.MemoId, 1);

            //Assert
            Assert.False(result);
            mockMemoDataStore.DidNotReceiveWithAnyArgs().UpdateMemo(Arg.Any&lt;CNMemo&gt;());
        }
        [Test]
        public async Task AddAMemoToGlobal_Success()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Assess
            var assesMemo = DomainTestHelper.GetARandomMemo(true);
            mockMemoDataStore.AddMemo(assesMemo).Returns(assesMemo);

            //Act
            await targetService.AddAMemoToGlobal(assesMemo);

            //Assert
            mockMemoDataStore.Received().AddMemo(Arg.Is&lt;CNMemo&gt;(x=&gt;x.MemoId == assesMemo.MemoId));
        }
        [Test]
        public async Task AddAMemoToGlobal_Null_Fail()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Assess
            var assesMemo = DomainTestHelper.GetARandomMemo(true);
            //Act
            var result = await targetService.AddAMemoToGlobal(null);

            //Assert
            Assert.IsTrue(string.IsNullOrEmpty(result));
            mockMemoDataStore.DidNotReceiveWithAnyArgs().AddMemo(assesMemo);
        }

        [Test]
        public async Task UpdateAMemo_Success()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Assess
            var assesMemo = DomainTestHelper.GetARandomMemo(true);
            mockMemoDataStore.UpdateMemo(assesMemo);

            //Act
            await targetService.UpdateAMemo(assesMemo);

            //Assert
            mockMemoDataStore.Received().UpdateMemo(Arg.Is&lt;CNMemo&gt;(x =&gt; x.MemoId == assesMemo.MemoId));
        }
        [Test]
        public async Task UpdateAMemo_Null_Fail()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Assess
            var assesMemo = DomainTestHelper.GetARandomMemo(true);
            //Act
            var result = await targetService.UpdateAMemo(null);

            //Assert
            Assert.IsFalse(result);
            mockMemoDataStore.DidNotReceiveWithAnyArgs().UpdateMemo(assesMemo);
        }
        [Test]
        public async Task GetAllGlobalMemos_Traverse()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Act
            await targetService.GetAllGlobalMemos();

            //Assert
            await mockMemoDataStore.Received().GetAllGlobalMemos();
        }
        [Test]
        public async Task GetAllTaskMemos_Traverse()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Act
            await targetService.GetAllTaskMemos(1);

            //Assert
            await mockMemoDataStore.Received().GetAllTaskMemos(1);
        }
        [Test]
        public async Task GetMemoById_Traverse()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Act
            await targetService.GetMemoById(&quot;1&quot;);

            //Assert
            await mockMemoDataStore.Received().GetMemoById(&quot;1&quot;);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[18,9,18,10,0],[19,13,19,67,0],[20,13,20,67,0],[21,13,21,61,0],[24,13,24,102,0],[25,13,26,65,0],[29,13,29,70,0],[32,13,32,55,0],[33,13,33,85,0],[34,9,34,10,0],[37,9,37,10,0],[38,13,38,67,0],[39,13,39,67,0],[40,13,40,61,0],[41,13,41,62,0],[42,13,42,60,0],[43,13,43,112,0],[45,13,45,77,0],[46,13,47,65,0],[50,13,50,99,0],[53,13,53,58,0],[54,13,54,119,0],[55,9,55,10,0],[59,9,59,10,0],[60,13,60,67,0],[61,13,61,67,0],[62,13,62,61,0],[65,13,65,102,0],[66,13,66,61,0],[69,13,69,103,0],[72,13,72,58,0],[73,13,73,97,0],[74,9,74,10,0],[78,9,78,10,0],[79,13,79,67,0],[80,13,80,67,0],[81,13,81,61,0],[84,13,84,102,0],[85,13,85,61,0],[88,13,88,90,0],[91,13,91,97,0],[92,9,92,10,0],[95,9,95,10,0],[96,13,96,67,0],[97,13,97,67,0],[98,13,98,61,0],[101,13,101,82,0],[104,13,104,99,0],[107,13,107,57,0],[108,13,108,85,0],[109,9,109,10,0],[113,9,113,10,0],[114,13,114,67,0],[115,13,115,61,0],[118,13,118,66,0],[119,13,119,95,0],[122,13,122,75,0],[125,13,125,36,0],[126,13,126,103,0],[127,9,127,10,0],[131,9,131,10,0],[132,13,132,67,0],[133,13,133,61,0],[136,13,136,66,0],[137,13,137,100,0],[140,13,140,75,0],[143,13,143,36,0],[144,13,144,88,0],[145,9,145,10,0],[150,9,150,10,0],[151,13,151,67,0],[152,13,152,61,0],[155,13,155,67,0],[156,13,156,101,0],[159,13,159,87,0],[162,13,162,34,0],[163,13,163,88,0],[164,9,164,10,0],[168,9,168,10,0],[169,13,169,67,0],[170,13,170,61,0],[173,13,173,67,0],[174,13,174,63,0],[175,13,181,16,0],[182,13,182,97,0],[183,13,183,61,0],[185,13,185,89,0],[188,13,188,98,0],[189,9,189,10,0],[193,9,193,10,0],[194,13,194,67,0],[195,13,195,61,0],[198,13,198,67,0],[199,13,199,97,0],[202,13,202,87,0],[205,13,205,34,0],[206,13,206,88,0],[207,9,207,10,0],[210,9,210,10,0],[211,13,211,67,0],[212,13,212,61,0],[215,13,215,67,0],[216,13,216,69,0],[219,13,219,61,0],[222,13,222,99,0],[223,9,223,10,0],[226,9,226,10,0],[227,13,227,67,0],[228,13,228,61,0],[231,13,231,67,0],[233,13,233,69,0],[236,13,236,57,0],[237,13,237,77,0],[238,9,238,10,0],[242,9,242,10,0],[243,13,243,67,0],[244,13,244,61,0],[247,13,247,67,0],[248,13,248,53,0],[251,13,251,56,0],[254,13,254,104,0],[255,9,255,10,0],[258,9,258,10,0],[259,13,259,67,0],[260,13,260,61,0],[263,13,263,67,0],[265,13,265,64,0],[268,13,268,36,0],[269,13,269,80,0],[270,9,270,10,0],[273,9,273,10,0],[274,13,274,67,0],[275,13,275,61,0],[278,13,278,53,0],[281,13,281,68,0],[282,9,282,10,0],[285,9,285,10,0],[286,13,286,67,0],[287,13,287,61,0],[290,13,290,52,0],[293,13,293,67,0],[294,9,294,10,0],[297,9,297,10,0],[298,13,298,67,0],[299,13,299,61,0],[302,13,302,50,0],[305,13,305,65,0],[306,9,306,10,0]]);
    </script>
  </body>
</html>