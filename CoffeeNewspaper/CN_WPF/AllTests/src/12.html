<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>e:\githubproject\coffeenewspaper\coffeenewspaper\cn_cli\state\taskeditstate.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Drawing;
using System.Linq;
using CN_Core;
using CN_Core.Interfaces.Service;
using CN_Service;
using CoffeeNewspaper_CLI.ConsoleTables;
using Console = Colorful.Console;
namespace CoffeeNewspaper_CLI
{
    public class TaskEditState : BaseState
    {
        public override void InitialCommandList()
        {
            base.InitialCommandList();
            CommandList.Add(new TaskEditCommand(this));
            CommandList.Add(new TagCommand(this));
            CommandList.Add(new SaveTaskCommand(this));
        }

        public override void Refresh()
        {
            if (StateObj == null) StateObj = new CNTask();
            if (StateObj is CNTask task)
            {
                Console.WriteAscii(task.TaskId == 0?&quot;New Task&quot;:&quot;Edit Task&quot;,
                    SaveTaskCommand.ValidInputComplete(task) ? Color.LawnGreen : Color.SandyBrown);

                Console.WriteLine();
                if (task.IsFail)
                {
                    Console.WriteLine($&quot;{&quot;IsFail:&quot;,-20}{task.IsFail}&quot;);
                    Console.WriteLine($&quot;{&quot;FailReason:&quot;,-20}{task.FailReason}&quot;);
                }

                if (task.IsDeleted)
                {
                    Console.WriteLine($&quot;{&quot;IsDeleted:&quot;,-20}{task.IsDeleted}&quot;);
                }
                Console.WriteLine($&quot;{&quot;Content:&quot;,-20}{task.Content}&quot;);
                Console.WriteLine($&quot;{&quot;DeadLine:&quot;,-20}{task.DeadLine}&quot;);
                Console.WriteLine($&quot;{&quot;EstimatedDuration:&quot;,-20}{DisplayDuration(task.EstimatedDuration)}&quot;);
                Console.WriteLine($&quot;{&quot;Priority&quot;,-20}{Enum.GetName(typeof(CNPriority), task.Priority)}&quot;);
                Console.WriteLine($&quot;{&quot;Urgency:&quot;,-20}{Enum.GetName(typeof(CNUrgency), task.Urgency)}&quot;);
                Console.WriteLine($&quot;{&quot;Tags:&quot;,-20}{string.Join(&quot;,&quot;,(task.TaskTaggers??new List&lt;CNTaskTagger&gt;()).ToList().Select(x=&gt;x.Tag).Select(y=&gt;y.Title))}&quot;);
                Console.WriteLine($&quot;{&quot;CreateTime:&quot;,-20}{(task.CreateTime &gt; DateTime.MinValue?task.CreateTime:DateTime.Now)}&quot;);
                Console.WriteLine($&quot;{&quot;StartTime:&quot;,-20}{task.StartTime}&quot;);
                Console.WriteLine($&quot;{&quot;EndTime:&quot;,-20}{task.EndTime}&quot;);
                Console.WriteLine($&quot;{&quot;Memos:&quot;,-20}{(task.TaskMemos??new List&lt;CNTaskMemo&gt;()).Select(x=&gt;x.Memo).ToList().Count + &quot;memos&quot;}&quot;);

                if (!string.IsNullOrEmpty(task.ParentTask?.Content))
                {
                        Console.WriteLine($&quot;{&quot;Parent:&quot;,-20}({task.ParentTask.TaskId}){task.ParentTask.Content}&quot;);
                }

                if (task.PreTaskConnectors.Any())
                {
                    Console.WriteLine($&quot;{&quot;PreTaskIds:&quot;,-20}&quot;);
                    var preTasks = task.PreTaskConnectors.Select(x=&gt;x.PreTask);
                    ConsoleTable tables = ConsoleTable.From(preTasks.Select(x =&gt; new { TaskID = x.TaskId, x.Content }));
                    tables.WriteAlternateColorTable(Color.LightGoldenrodYellow, Color.White);
                }

                Console.WriteLine($&quot;{&quot;Status:&quot;,-20}{Enum.GetName(typeof(CNTaskStatus), task.Status)}&quot;);
            }
            else
            {
                Console.WriteLine(&quot;StateObj wrong , please restart!&quot;);
            }
            Console.WriteLine();
        }

        public override void DisplayCmdLine()
        {
            if (StateObj is CNTask task)
            {
                Console.Write((task.TaskId == 0 ? &quot;New Task&quot; : &quot;Edit Task&quot;) + &quot;&gt; &quot;, Color.White);
            }
            else
            {
                Console.Write(&quot;Drink a Coffee&gt; &quot;, Color.White);
            }
        }

        private string DisplayDuration(long estimatedDurationMinutes)
        {
            var minutes = estimatedDurationMinutes % 60;
            var remains = (estimatedDurationMinutes - minutes) / 60;
            var hours = remains % 24;
            remains = (remains - hours) / 24;
            var days = remains % 7;
            var weeks = (remains - days) / 7;
            var result = 
                $&quot;{(weeks &gt; 0 ? (weeks + &quot;w&quot;) : &quot;&quot;)}{(days &gt; 0 ? (days + &quot;d&quot;) : &quot;&quot;)}{(hours &gt; 0 ? (hours + &quot;h&quot;) : &quot;&quot;)}&quot;;
            if (string.IsNullOrEmpty(result) || minutes &gt; 0)
            {
                result += minutes + &quot;m&quot;;
            }

            return result;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[15,9,15,10,0],[16,13,16,39,0],[17,13,17,56,0],[18,13,18,51,0],[19,13,19,56,0],[20,9,20,10,0],[23,9,23,10,0],[24,13,24,34,0],[24,35,24,59,0],[25,13,25,41,0],[26,13,26,14,0],[27,17,28,100,0],[30,17,30,37,0],[31,17,31,33,0],[32,17,32,18,0],[33,21,33,72,0],[34,21,34,80,0],[35,17,35,18,0],[37,17,37,36,0],[38,17,38,18,0],[39,21,39,78,0],[40,17,40,18,0],[41,17,41,70,0],[42,17,42,72,0],[43,17,43,107,0],[44,17,44,105,0],[45,17,45,103,0],[46,17,46,131,0],[46,131,46,136,0],[46,136,46,148,0],[46,148,46,155,0],[46,155,46,161,0],[46,17,46,161,0],[47,17,47,127,0],[48,17,48,74,0],[49,17,49,70,0],[50,17,50,103,0],[50,103,50,109,0],[50,109,50,139,0],[50,17,50,139,0],[52,17,52,69,0],[53,17,53,18,0],[54,25,54,114,0],[55,17,55,18,0],[57,17,57,50,0],[58,17,58,18,0],[59,21,59,63,0],[60,21,60,69,0],[60,69,60,78,0],[60,78,60,80,0],[60,21,60,80,0],[61,21,61,82,0],[61,82,61,118,0],[61,118,61,121,0],[61,21,61,121,0],[62,21,62,94,0],[63,17,63,18,0],[65,17,65,104,0],[66,13,66,14,0],[68,13,68,14,0],[69,17,69,71,0],[70,13,70,14,0],[71,13,71,33,0],[72,9,72,10,0],[75,9,75,10,0],[76,13,76,41,0],[77,13,77,14,0],[78,17,78,98,0],[79,13,79,14,0],[81,13,81,14,0],[82,17,82,64,0],[83,13,83,14,0],[84,9,84,10,0],[87,9,87,10,0],[88,13,88,57,0],[89,13,89,69,0],[90,13,90,38,0],[91,13,91,46,0],[92,13,92,36,0],[93,13,93,46,0],[94,13,95,121,0],[96,13,96,61,0],[97,13,97,14,0],[98,17,98,41,0],[99,13,99,14,0],[101,13,101,27,0],[102,9,102,10,0]]);
    </script>
  </body>
</html>