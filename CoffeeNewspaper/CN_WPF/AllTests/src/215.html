<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>e:\githubproject\coffeenewspaper\coffeenewspaper\cn_core\logging\implementation\baselogfactory.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.IO;
using System.Runtime.CompilerServices;
using CN_Core.Interfaces;

namespace CN_Core.Logging
{
    public class BaseLogFactory : ILogFactory
    {
        #region Protected Methods

        /// &lt;summary&gt;
        /// The list of loggers in this factory
        /// &lt;/summary&gt;
        protected List&lt;ILogger&gt; mLoggers = new List&lt;ILogger&gt;();

        /// &lt;summary&gt;
        /// A lock for the logger list to keep it thread-safe
        /// &lt;/summary&gt;
        protected object mLoggersLock = new object();

        #endregion

        #region Public Properties

        /// &lt;summary&gt;
        /// The level of logging to output
        /// &lt;/summary&gt;
        public LogOutputLevel LogOutputLevel { get; set; }

        /// &lt;summary&gt;
        /// If true, includes the origin of where the log message was logged from
        /// such as the class name, line number and file name
        /// &lt;/summary&gt;
        public bool IncludeLogOriginDetails { get; set; } = true;

        #endregion

        #region Public Events

        /// &lt;summary&gt;
        /// Fires whenever a new log arrives
        /// &lt;/summary&gt;
        public event Action&lt;(string Message, LogLevel Level)&gt; NewLog = (details) =&gt; { };

        #endregion

        #region Constructor

        /// &lt;summary&gt;
        /// Default constructor
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;loggers&quot;&gt;The loggers to add to the factory, on top of the stock loggers already included&lt;/param&gt;
        public BaseLogFactory(ILogger[] loggers = null)
        {
            // Add console logger
            //            AddLogger(new FileLogger(&quot;log.txt&quot;));
            AddLogger(new DebugLogger());
            // Add any others passed in
            if (loggers != null)
                foreach (var logger in loggers)
                    AddLogger(logger);
        }

        #endregion

        #region Public Methods

        /// &lt;summary&gt;
        /// Adds the specific logger to this factory
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;logger&quot;&gt;The logger&lt;/param&gt;
        public void AddLogger(ILogger logger)
        {
            // Log the list so it is thread-safe
            lock (mLoggersLock)
            {
                // If the logger is not already in the list...
                if (!mLoggers.Contains(logger))
                    // Add the logger to the list
                    mLoggers.Add(logger);
            }
        }

        /// &lt;summary&gt;
        /// Removes the specified logger from this factory
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;logger&quot;&gt;The logger&lt;/param&gt;
        public void RemoveLogger(ILogger logger)
        {
            // Log the list so it is thread-safe
            lock (mLoggersLock)
            {
                // If the logger is in the list...
                if (mLoggers.Contains(logger))
                    // Remove the logger from the list
                    mLoggers.Remove(logger);
            }
        }

        /// &lt;summary&gt;
        /// Logs the specific message to all loggers in this factory
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;message&quot;&gt;The message to log&lt;/param&gt;
        /// &lt;param name=&quot;level&quot;&gt;The level of the message being logged&lt;/param&gt;
        /// &lt;param name=&quot;origin&quot;&gt;The method/function this message was logged in&lt;/param&gt;
        /// &lt;param name=&quot;filePath&quot;&gt;The code filename that this message was logged from&lt;/param&gt;
        /// &lt;param name=&quot;lineNumber&quot;&gt;The line of code in the filename this message was logged from&lt;/param&gt;
        public void Log(
            string message,
            LogLevel level = LogLevel.Informative, 
            [CallerMemberName] string origin = &quot;&quot;,
            [CallerFilePath] string filePath = &quot;&quot;,
            [CallerLineNumber] int lineNumber = 0)
        {
            // If we should not log the message as the level is too low...
            if ((int)level &lt; (int)LogOutputLevel)
                return;

            // If the user wants to know where the log originated from...
            if (IncludeLogOriginDetails)
                message = $&quot;{message} [{Path.GetFileName(filePath)} &gt; {origin}() &gt; Line {lineNumber}]&quot;;

            // Log the list so it is thread-safe
            lock (mLoggersLock)
            {
                // Log to all loggers
                mLoggers.ForEach(logger =&gt; logger.Log(message, level));
            }

            // Inform listeners
            NewLog.Invoke((message, level));
        }

        #endregion
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[16,9,16,64,1],[21,9,21,54,1],[30,48,30,52,1],[30,53,30,57,0],[36,47,36,51,1],[36,52,36,56,0],[36,61,36,65,1],[45,9,45,85,1],[45,85,45,86,1],[45,86,45,87,1],[45,87,45,88,1],[45,88,45,89,1],[45,9,45,89,1],[55,9,55,56,1],[56,9,56,10,1],[59,13,59,42,1],[61,13,61,33,1],[62,17,62,24,0],[62,26,62,36,0],[62,37,62,39,0],[62,40,62,47,0],[63,21,63,39,0],[64,9,64,10,1],[75,9,75,10,1],[77,13,77,32,1],[78,13,78,14,1],[80,17,80,48,1],[82,21,82,42,1],[83,13,83,14,1],[84,9,84,10,1],[91,9,91,10,0],[93,13,93,32,0],[94,13,94,14,0],[96,17,96,47,0],[98,21,98,45,0],[99,13,99,14,0],[100,9,100,10,0],[116,9,116,10,1],[118,13,118,50,1],[119,17,119,24,0],[122,13,122,41,1],[123,17,123,104,1],[126,13,126,32,1],[127,13,127,14,1],[129,17,129,44,1],[129,44,129,70,1],[129,70,129,72,1],[129,17,129,72,1],[130,13,130,14,1],[133,13,133,45,1],[134,9,134,10,1]]);
    </script>
  </body>
</html>