<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>e:\githubproject\coffeenewspaper\coffeenewspaper\coffeenewspaper_unittest\servicetest\memoservicetest.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Collections.Generic;
using System.Threading.Tasks;
using CN_Core;
using CN_Core.Interfaces.Repository;
using CN_Core.Interfaces.Service;
using CoffeeNewspaper_UnitTest.DomainTest;
using Ninject;
using NSubstitute;
using NUnit.Framework;

namespace CoffeeNewspaper_UnitTest.ServiceTest
{
    [TestFixture]
    public class MemoServiceTest : ServiceSetupTearDown
    {
        [Test]
        public async Task AddAMemoToTask_MemoNull_Fail()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var mockTaskDataStore = _kernel.Get&lt;ITaskDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Assess
            mockTaskDataStore.GetTask(1).Returns(Task.FromResult(DomainTestHelper.GetARandomTask()));
            mockMemoDataStore.AddMemo(Arg.Any&lt;CNMemo&gt;())
                .Returns(DomainTestHelper.GetARandomMemo(true));

            //Act
            var result = await targetService.AddAMemoToTask(null, 1);

            //Assert
            Assert.True(string.IsNullOrEmpty(result));
            mockMemoDataStore.DidNotReceiveWithAnyArgs().AddMemo(Arg.Any&lt;CNMemo&gt;());
        }
        [Test]
        public async Task AddAMemoToTask_TaskExist_Success()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var mockTaskDataStore = _kernel.Get&lt;ITaskDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();
            var mockTask = DomainTestHelper.GetARandomTask();
            var mockTag = DomainTestHelper.GetARandomTag();
            mockTask.TaskTaggers = new List&lt;CNTaskTagger&gt;(){new CNTaskTagger(){Tag = mockTag,Task = mockTask}};
            //Assess
            mockTaskDataStore.GetTask(1).Returns(Task.FromResult(mockTask));
            mockMemoDataStore.AddMemo(Arg.Any&lt;CNMemo&gt;())
                .Returns(DomainTestHelper.GetARandomMemo(true));

            //Act
            var result = await targetService.AddAMemoToTask(DomainTestHelper.GetARandomMemo(), 1);

            //Assert
            Assert.IsFalse(string.IsNullOrEmpty(result));
            mockMemoDataStore.Received().AddMemo(Arg.Is&lt;CNMemo&gt;(x =&gt; x.TaskMemos.Count &gt; 0 &amp;&amp; x.MemoTaggers.Count&gt;0));
        }

        [Test]
        public async Task AddAMemoToTask_TaskExistMemoExist_Success()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var mockTaskDataStore = _kernel.Get&lt;ITaskDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Assess
            mockTaskDataStore.GetTask(1).Returns(Task.FromResult(DomainTestHelper.GetARandomTask()));
            mockMemoDataStore.UpdateMemo(Arg.Any&lt;CNMemo&gt;());

            //Act
            var result = await targetService.AddAMemoToTask(DomainTestHelper.GetARandomMemo(true), 1);

            //Assert
            Assert.IsFalse(string.IsNullOrEmpty(result));
            mockMemoDataStore.Received().UpdateMemo(Arg.Is&lt;CNMemo&gt;(x =&gt; x.TaskMemos.Count &gt; 0));
        }

        [Test]
        public async Task AddAMemoToTask_DBFail_False()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var mockTaskDataStore = _kernel.Get&lt;ITaskDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Assess
            mockTaskDataStore.GetTask(1).Returns(Task.FromResult(DomainTestHelper.GetARandomTask()));
            mockMemoDataStore.UpdateMemo(Arg.Any&lt;CNMemo&gt;());

            //Act
            await targetService.AddAMemoToTask(DomainTestHelper.GetARandomMemo(true), 1);

            //Assert
            mockMemoDataStore.Received().UpdateMemo(Arg.Is&lt;CNMemo&gt;(x =&gt; x.TaskMemos.Count &gt; 0));
        }
        [Test]
        public async Task AddAMemoToTask_TaskNotExist_Fail()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var mockTaskDataStore = _kernel.Get&lt;ITaskDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Assess
            mockTaskDataStore.GetTask(1).Returns(Task.FromResult((CNTask) null));

            //Act
            var result = await targetService.AddAMemoToTask(DomainTestHelper.GetARandomMemo(), 1);

            //Assert
            Assert.IsTrue(string.IsNullOrEmpty(result));
            mockMemoDataStore.DidNotReceiveWithAnyArgs().AddMemo(Arg.Any&lt;CNMemo&gt;());
        }

        [Test]
        public async Task DeleteAMemo_MemoExist_Success()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Assess
            var testMemo = DomainTestHelper.GetARandomMemo(true);
            mockMemoDataStore.GetMemoById(testMemo.MemoId).Returns(Task.FromResult(testMemo));

            //Act
            var result = await targetService.DeleteAMemo(testMemo.MemoId);

            //Assert
            Assert.IsFalse(result);
            mockMemoDataStore.Received().DeleteMemo(Arg.Is&lt;CNMemo&gt;(x =&gt; x.MemoId == testMemo.MemoId));
        }

        [Test]
        public async Task DeleteAMemo_MemoNotExist_Fail()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Assess
            var testMemo = DomainTestHelper.GetARandomMemo(true);
            mockMemoDataStore.GetMemoById(testMemo.MemoId).Returns(Task.FromResult((CNMemo) null));

            //Act
            var result = await targetService.DeleteAMemo(testMemo.MemoId);

            //Assert
            Assert.IsFalse(result);
            mockMemoDataStore.DidNotReceiveWithAnyArgs().DeleteMemo(Arg.Any&lt;CNMemo&gt;());
        }


        [Test]
        public async Task RemoveAMemoFromTask_MemoNotExist_Fail()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Assess
            var assesMemo = DomainTestHelper.GetARandomMemo(true);
            mockMemoDataStore.GetMemoById(assesMemo.MemoId).Returns(Task.FromResult((CNMemo) null));

            //Act
            var result = await targetService.RemoveAMemoFromTask(assesMemo.MemoId, 1);

            //Assert
            Assert.False(result);
            mockMemoDataStore.DidNotReceiveWithAnyArgs().UpdateMemo(Arg.Any&lt;CNMemo&gt;());
        }

        [Test]
        public async Task RemoveAMemoFromTask_Success()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Assess
            var assesMemo = DomainTestHelper.GetARandomMemo(true);
            var assesTask = DomainTestHelper.GetARandomTask();
            assesMemo.TaskMemos.Add(new CNTaskMemo
            {
                Memo = assesMemo,
                MemoId = assesMemo.MemoId,
                Task = assesTask,
                TaskId = assesTask.TaskId
            });
            mockMemoDataStore.GetMemoById(assesMemo.MemoId).Returns(Task.FromResult(assesMemo));
            mockMemoDataStore.UpdateMemo(Arg.Any&lt;CNMemo&gt;());
            //Act
            await targetService.RemoveAMemoFromTask(assesMemo.MemoId, assesTask.TaskId);

            //Assert
            mockMemoDataStore.Received().UpdateMemo(Arg.Is&lt;CNMemo&gt;(x =&gt; x.TaskMemos.Count == 0));
        }

        [Test]
        public async Task RemoveAMemoFromTask_TaskMemoRelationNotExist_Fail()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Assess
            var assesMemo = DomainTestHelper.GetARandomMemo(true);
            mockMemoDataStore.GetMemoById(assesMemo.MemoId).Returns(Task.FromResult(assesMemo));

            //Act
            var result = await targetService.RemoveAMemoFromTask(assesMemo.MemoId, 1);

            //Assert
            Assert.False(result);
            mockMemoDataStore.DidNotReceiveWithAnyArgs().UpdateMemo(Arg.Any&lt;CNMemo&gt;());
        }
        [Test]
        public async Task AddAMemoToGlobal_Success()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Assess
            var assesMemo = DomainTestHelper.GetARandomMemo(true);
            mockMemoDataStore.AddMemo(assesMemo).Returns(assesMemo);

            //Act
            await targetService.AddAMemoToGlobal(assesMemo);

            //Assert
            mockMemoDataStore.Received().AddMemo(Arg.Is&lt;CNMemo&gt;(x=&gt;x.MemoId == assesMemo.MemoId));
        }
        [Test]
        public async Task AddAMemoToGlobal_Null_Fail()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Assess
            var assesMemo = DomainTestHelper.GetARandomMemo(true);
            //Act
            var result = await targetService.AddAMemoToGlobal(null);

            //Assert
            Assert.IsTrue(string.IsNullOrEmpty(result));
            mockMemoDataStore.DidNotReceiveWithAnyArgs().AddMemo(assesMemo);
        }

        [Test]
        public async Task UpdateAMemo_Success()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Assess
            var assesMemo = DomainTestHelper.GetARandomMemo(true);
            mockMemoDataStore.UpdateMemo(assesMemo);

            //Act
            await targetService.UpdateAMemo(assesMemo);

            //Assert
            mockMemoDataStore.Received().UpdateMemo(Arg.Is&lt;CNMemo&gt;(x =&gt; x.MemoId == assesMemo.MemoId));
        }
        [Test]
        public async Task UpdateAMemo_Null_Fail()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Assess
            var assesMemo = DomainTestHelper.GetARandomMemo(true);
            //Act
            var result = await targetService.UpdateAMemo(null);

            //Assert
            Assert.IsFalse(result);
            mockMemoDataStore.DidNotReceiveWithAnyArgs().UpdateMemo(assesMemo);
        }
        [Test]
        public async Task GetAllGlobalMemos_Traverse()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Act
            await targetService.GetAllGlobalMemos();

            //Assert
            await mockMemoDataStore.Received().GetAllGlobalMemos();
        }
        [Test]
        public async Task GetAllTaskMemos_Traverse()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Act
            await targetService.GetAllTaskMemos(1);

            //Assert
            await mockMemoDataStore.Received().GetAllTaskMemos(1);
        }
        [Test]
        public async Task GetMemoById_Traverse()
        {
            var mockMemoDataStore = _kernel.Get&lt;IMemoDataStore&gt;();
            var targetService = _kernel.Get&lt;IMemoService&gt;();

            //Act
            await targetService.GetMemoById(&quot;1&quot;);

            //Assert
            await mockMemoDataStore.Received().GetMemoById(&quot;1&quot;);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[18,9,18,10,1],[19,13,19,67,1],[20,13,20,67,1],[21,13,21,61,1],[24,13,24,102,1],[25,13,26,65,1],[29,13,29,70,1],[32,13,32,55,1],[33,13,33,85,1],[34,9,34,10,1],[37,9,37,10,1],[38,13,38,67,1],[39,13,39,67,1],[40,13,40,61,1],[41,13,41,62,1],[42,13,42,60,1],[43,13,43,112,1],[45,13,45,77,1],[46,13,47,65,1],[50,13,50,99,1],[53,13,53,58,1],[54,13,54,119,1],[55,9,55,10,1],[59,9,59,10,1],[60,13,60,67,1],[61,13,61,67,1],[62,13,62,61,1],[65,13,65,102,1],[66,13,66,61,1],[69,13,69,103,1],[72,13,72,58,1],[73,13,73,97,1],[74,9,74,10,1],[78,9,78,10,1],[79,13,79,67,1],[80,13,80,67,1],[81,13,81,61,1],[84,13,84,102,1],[85,13,85,61,1],[88,13,88,90,1],[91,13,91,97,1],[92,9,92,10,1],[95,9,95,10,1],[96,13,96,67,1],[97,13,97,67,1],[98,13,98,61,1],[101,13,101,82,1],[104,13,104,99,1],[107,13,107,57,1],[108,13,108,85,1],[109,9,109,10,1],[113,9,113,10,1],[114,13,114,67,1],[115,13,115,61,1],[118,13,118,66,1],[119,13,119,95,1],[122,13,122,75,1],[125,13,125,36,1],[126,13,126,103,1],[127,9,127,10,1],[131,9,131,10,1],[132,13,132,67,1],[133,13,133,61,1],[136,13,136,66,1],[137,13,137,100,1],[140,13,140,75,1],[143,13,143,36,1],[144,13,144,88,1],[145,9,145,10,1],[150,9,150,10,1],[151,13,151,67,1],[152,13,152,61,1],[155,13,155,67,1],[156,13,156,101,1],[159,13,159,87,1],[162,13,162,34,1],[163,13,163,88,1],[164,9,164,10,1],[168,9,168,10,1],[169,13,169,67,1],[170,13,170,61,1],[173,13,173,67,1],[174,13,174,63,1],[175,13,181,16,1],[182,13,182,97,1],[183,13,183,61,1],[185,13,185,89,1],[188,13,188,98,1],[189,9,189,10,1],[193,9,193,10,1],[194,13,194,67,1],[195,13,195,61,1],[198,13,198,67,1],[199,13,199,97,1],[202,13,202,87,1],[205,13,205,34,1],[206,13,206,88,1],[207,9,207,10,1],[210,9,210,10,1],[211,13,211,67,1],[212,13,212,61,1],[215,13,215,67,1],[216,13,216,69,1],[219,13,219,61,1],[222,13,222,99,1],[223,9,223,10,1],[226,9,226,10,1],[227,13,227,67,1],[228,13,228,61,1],[231,13,231,67,1],[233,13,233,69,1],[236,13,236,57,1],[237,13,237,77,1],[238,9,238,10,1],[242,9,242,10,1],[243,13,243,67,1],[244,13,244,61,1],[247,13,247,67,1],[248,13,248,53,1],[251,13,251,56,1],[254,13,254,104,1],[255,9,255,10,1],[258,9,258,10,1],[259,13,259,67,1],[260,13,260,61,1],[263,13,263,67,1],[265,13,265,64,1],[268,13,268,36,1],[269,13,269,80,1],[270,9,270,10,1],[273,9,273,10,1],[274,13,274,67,1],[275,13,275,61,1],[278,13,278,53,1],[281,13,281,68,1],[282,9,282,10,1],[285,9,285,10,1],[286,13,286,67,1],[287,13,287,61,1],[290,13,290,52,1],[293,13,293,67,1],[294,9,294,10,1],[297,9,297,10,1],[298,13,298,67,1],[299,13,299,61,1],[302,13,302,50,1],[305,13,305,65,1],[306,9,306,10,1]]);
    </script>
  </body>
</html>